<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Leaderboard</title>
  <style>
  :root{
       --hand-gap: 10px;
        --card-ratio: 1.6;   /* height = width * ratio; tweak if your art needs */
      --cardW: 100px;    
      --bg: #0b0f19;
      --panel: #111827;
      --text: #00ffc6;
      --text-dim: #7fffe6;
      --accent: #ffcc00;
      --accent-2: #ff3df7;
      --accent-3: #6ae3ff;
      --card-bg: #222638;
      --card-border: #3af5d9;
      --danger: #ff5577;
      --ok: #45ff99;
    }
    /* Always hide elements with [hidden], and loaders by default */
[hidden] { display: none !important; }
.loading { display: none !important; }     /* stays hidden until .show is added */
.loading.show { display: block !important; }
.hidden { display: none !important; }

/* Visually hidden utility */
.sr-only { 
  position: absolute !important;
  width: 1px; height: 1px; padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0,0,1px,1px); white-space: nowrap; border: 0;
}

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 800px at 50% -20%, #13203b 0%, #0b0f19 60%, #05070d 100%),
        linear-gradient(180deg, #0b0f19 0%, #05070d 100%);
      color: var(--text);
      padding: 24px;
    }
  #toasts {
    position: fixed; top: 12px; right: 12px; z-index: 9999;
    display: flex; flex-direction: column; gap: 8px;
    pointer-events: none;
  }
  .toast {
    pointer-events: auto;
    background: rgba(20,20,20,.92);
    color: #fff; border-radius: 12px; padding: 10px 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,.25);
    font: 600 14px system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    transform: translateY(-6px); opacity: 0;
    transition: transform .18s ease-out, opacity .18s ease-out;
    max-width: 320px; line-height: 1.25;
    border-left: 4px solid #888;
  }
  .toast.show { transform: translateY(0); opacity: 1; }
  .toast.hide { transform: translateX(8px); opacity: 0; }
  .toast.win   { border-left-color: #22c55e; }  /* green */
  .toast.bonus { border-left-color: #06b6d4; }  /* cyan  */
  .toast.error { border-left-color: #ef4444; }  /* red   */

  .toast .close {
    float: right; margin-left: 8px; font-weight: 700; cursor: pointer; opacity: .7;
  }
  .toast .close:hover { opacity: 1; }

  @media (prefers-reduced-motion: reduce) {
    .toast, .toast.show, .toast.hide { transition: none; }
  }
    /* Header / Nav */
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin: 0 auto 16px; max-width: 1100px; }
    .brand { display: flex; align-items: center; gap: 10px; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(0,255,198,0.6); }
    .brand-badge {
      width: 36px; height: 36px; border-radius: 10px; border: 2px solid var(--card-border);
      box-shadow: 0 0 14px rgba(0,255,198,0.2); display: grid; place-items: center;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      font-weight: 700; color: var(--accent);
    }
    nav { display: flex; gap: 10px; flex-wrap: wrap; }

    .btn {
      appearance: none; border: 0; cursor: pointer; padding: 10px 14px; border-radius: 12px;
      color: #000; background: var(--accent); text-decoration: none;
      box-shadow: 0 3px 0 #b59000, 0 0 12px rgba(255,204,0,0.35);
      font-weight: 700; letter-spacing: .2px; display: inline-flex; align-items: center; gap: 8px;
      transition: transform .06s ease, filter .12s ease, box-shadow .12s ease;
      font-size: 12px;
    }
    .btn:hover { transform: translateY(-1px); filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }
    .btn:disabled { background: #555; color: #111; box-shadow: none; cursor: not-allowed; }
    .btn:focus-visible { outline: 2px solid var(--accent-3); outline-offset: 2px; }
    .btn-telegram{
      background: var(--accent-3);
      box-shadow: 0 3px 0 #2aa7bf, 0 0 14px rgba(106,227,255,0.35);
      color: #021018;
    }
    .btn-primary{
      background: var(--accent-2);
      color: #021018;
      box-shadow: 0 3px 0 #a2259c, 0 0 14px rgba(255,61,247,0.35);
    }
    .btn-ghost{
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      color: var(--text);
      border: 1px solid rgba(58,245,217,0.35);
      box-shadow: 0 0 12px rgba(0,255,198,0.18) inset, 0 0 12px rgba(0,255,198,0.12);
    }

    /* Layout panels */
    .wrap { max-width: 1100px; margin: 0 auto; }

/* Stack on tablets/phones */
@media (max-width: 1024px) {
  .hud { grid-template-columns: 1fr; }
  .panel-table, .panel-claim { grid-column: 1; }
}
  .panel {
  /* back to a normal card */
  display: block;
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
  border: 1px solid rgba(58,245,217,0.3);
  border-radius: 16px;
  padding: 16px;
  backdrop-filter: blur(4px);
  box-shadow: 0 0 24px rgba(0,255,198,0.06) inset, 0 0 24px rgba(0,255,198,0.08);
}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <div class="bar">
        <h1 id="title">Leaderboard</h1>
        <div class="tabs">
            <a class = "btn btn-primary" href="blackjack.html">Play BlackJack</a>
            <a class="btn btn-primary" href="/play.html" aria-current="page">Poker</a>
          <a class="btn ghost" href="?game=poker">Poker Leaderboard</a>
          <a class="btn ghost" href="?game=blackjack">Blackjack Leaderboard</a>
        </div>
      </div>
      <div class="hint">This page shows the Top 25 and a personal window around your current rank.</div>
    </div>
 
    <div class="panel">
      <h2>Top 25</h2>
      <ol id="lbTopList" class="leaderboard"></ol>
    </div>

    <div class="panel">
      <h2>Your Rank (Â±3)</h2>
      <div id="youLine" class="hint"></div>
      <ol id="lbWindowList" class="leaderboard"></ol>
      <div id="youHint" class="hint"></div>
    </div>
  </div>
<ol id="lbTopList" class="leaderboard"></ol>
<ol id="lbWindowList" class="leaderboard"></ol>
  <script>
 function getGame(){
  const p = new URLSearchParams(location.search);
  const g = (p.get('game')||'poker').toLowerCase();
  return (g==='blackjack')?'blackjack':'poker';
}

async function loadTop(game){
  const list = document.getElementById('lbTopList');   // <ol id="lbTopList">
  list.innerHTML = '';

  const r = await fetch(`/api/leaderboard/top?game=${game}&limit=25`, { credentials:'include' });
  const d = await r.json(); if (!d.ok) return { entries:[], youInTop:false };

  // Start numbering at the true first rank
  if (d.entries.length) list.start = Number(d.entries[0].rank) || 1;

  d.entries.forEach((e) => {
    const li = document.createElement('li');
    li.dataset.rank = e.rank;
    li.value = Number(e.rank) || undefined;   // keeps numbering correct even with gaps
    li.innerHTML = `<span class="user">${e.user}</span><span class="pts"> ${e.points}</span>`;
    list.appendChild(li);
  });
  return d;
}

async function loadWindow(game){
  const list   = document.getElementById('lbWindowList'); // <ol id="lbWindowList">
  const youLine= document.getElementById('youLine');
  const youHint= document.getElementById('youHint');
  list.innerHTML = ''; youLine.textContent = ''; youHint.textContent = '';

  const r = await fetch(`/api/leaderboard/window?game=${game}&k=3`, { credentials:'include' });
  const d = await r.json(); if (!d.ok) return null;

  if (d.window.length) list.start = Number(d.window[0].rank) || 1;

  d.window.forEach((row) => {
    const li = document.createElement('li');
    li.value = Number(row.rank) || undefined;
    li.innerHTML = `<span class="user">${row.user}</span><span class="pts"> ${row.points}</span>`;
    if (row.you) { li.classList.add('you'); li.style.fontWeight = '700'; }
    list.appendChild(li);
  });

  if (d.you){
    youLine.textContent = `You are #${d.you.rank} with ${d.you.points} pts`;
    if (d.you.deltaAhead != null) youHint.textContent = `Only ${d.you.deltaAhead} pts to the next rank.`;
  }
  return d;
}

function highlightYouInTop(topData, winData){
  if (!topData || !winData || !winData.you) return;
  const youRank = winData.you.rank;
  const li = document.querySelector(`#lbTopList li[data-rank="${youRank}"]`);
  if (li) { li.style.fontWeight = '700'; li.classList.add('you'); }
}

(async function init(){
  const game = getGame();
  document.getElementById('title').textContent =
    (game==='blackjack'?'Blackjack':'Poker') + ' Leaderboard';
  try{
    const [topData, winData] = await Promise.all([loadTop(game), loadWindow(game)]);
    highlightYouInTop(topData, winData);
  }catch{}
})();
  </script>
</body>
</html>
